.page.orders.index

  - if @orders_filtered || @orders.present?

    - if @gateway
      - @page_title = t("orders.index.all_orders_for_gateway") + @gateway.name
      %h2.pageTitle
        = t("orders.index.all_orders_for_gateway")
        %b= @gateway.name
    - else
      %h2.pageTitle= @page_title = t("orders.index.all_orders_for_all_gateways")

    .actions

      .activeFilters
        - if @gateway
          .filter{ data: { filter_name: 'gateway_id'}}
            = t("orders.index.gateway")
            %b
              = @gateway.name
              %span.close &times;
        - if params[:status]
          .filter{ data: { filter_name: 'status'}}
            = t("orders.index.status")
            %b
              = StraightServer::Order::STATUSES.invert[params[:status].to_i]
              %span.close &times;
      .filters
        - if @gateways && @gateways.size > 1
          %label= t("orders.index.gateway")
          = select_tag "filter_by_gateway", options_from_collection_for_select(@gateways, "id", "name", ), include_blank: true
        - unless params[:status]
          %label= t("orders.index.status")
          = select_tag "filter_by_status", options_from_collection_for_select(status_filter_collection, 'first', 'last'), include_blank: true

    .list
      %table
        %tr
          %th(style="width: 90px;")= t("orders.index.amount_btc")
          %th(style="width: 90px;")= t("orders.index.paid_amount_btc")
          %th= t("orders.index.address")
          - unless @gateway
            %th(style="width: 300px;")= t("orders.index.gateway")
          %th(style="width: 70px;")= t("orders.index.value_at_the_time_of_purchase_html").html_safe
          %th(style="width: 250px;")= t("orders.index.created_at")
          %th(style="width: 50px;")= t("orders.index.status")

        - @orders.each do |o|
          %tr{ class: "order #{StraightServer::Order::STATUSES.invert[o.status]}", data: { payment_id: o.payment_id, gateway_id: gateway_id_for_order(o) } }
            %td.amount= o.amount_in_btc(as: :string)
            %td.amount= o.amount_in_btc(field: o.amount_paid, as: :string)
            %td.address
              = o.address
              - if o.reused > 0
                %sup
                  = t("orders.index.reused")
                  = o.reused
            - unless @gateway
              %td= o.gateway.name
            %td(style="width: 250px;")
              - if o.data && o.kind_of?(Hash) && o.data[:exchange_rate]
                = "#{(o.data[:exchange_rate][:price]*o.amount_in_btc).round(2)} #{o.data[:exchange_rate][:currency]}"
            %td= o.created_at.strftime(t('orders.index.created_at_time'))
            %td
              %b= t("orders.index.#{StraightServer::Order::STATUSES.invert[o.status]}")

      = will_paginate(@orders)

  - else

    .noRecords
      - if @gateway
        %h2= t("orders.index.no_records.title_html", name: @gateway.name).html_safe
      - else
        %h2= t("orders.index.no_records.title")

      %p= t("orders.index.no_records.statement")
