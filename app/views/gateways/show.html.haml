- @page_title = "#{@gateway.name} | Gateways"

.page.gateways.show

  .pure-g
    .pure-u-12-24
      %h2= @gateway.name
    .pure-u-12-24
      = link_to "Edit settings", edit_gateway_path(@gateway), class: "button small editGateway"
  
  - if @gateway.description.present?
    %p= @gateway.description

  - if flash[:gateway_secret]
    .secret
      .warning
        Gateway settings saved. Please write this down. It is only displayed here once. This key is needed to access the API when creating orders and to sign callbacks. If you later lose this key, you will need to regenerate it.
      .value Your gateway secret is: <b>#{flash[:gateway_secret]}</b>


  - if @gateway.has_widget?

    = render partial: 'widgets/form'
    = render partial: 'widgets/preview'


  %table

    %tr
      %th Online store / site URL
      %td= @gateway.merchant_url

    %tr
      %th Country
      %td= @gateway.country

    %tr
      %th Region
      %td= @gateway.region

    %tr
      %th City
      %td= @gateway.city

    %tr
      %th Confirmations required
      %td= @gateway.confirmations_required

    - if @gateway.address_provider

      %tr
        %th Exchange
        %td= @gateway.address_provider.display_name

    - else

      %tr
        %th BIP32 pubkey
        %td= @gateway.pubkey.slice(0,16) + "..."

      %tr
        %th Address derivation scheme
        %td= @gateway.address_derivation_scheme

      - if (addresses = @gateway.generate_addresses(@show_addresses))
        %tr
          %th Addresses
          %td
            %form{action: gateway_path(@gateway), method: 'GET'}
              %textarea= addresses.map { |e| e.join(': ') }.join("\n")
              %input{type: 'text', id: 'show_addresses', name: 'show_addresses', value: @show_addresses.to_s}
              %input{type: 'submit', value: "Show"}
              .hint This is for you to make sure that addresses that are going to be used to generate orders are the same as in your wallet. Make sure they match. You can adjust the consecutive index above, so you are able to check more addresses generated by your wallet.

    %tr
      %th Default currency
      %td= @gateway.default_currency

    %tr
      %th Callback URL
      %td= @gateway.callback_url

    %tr
      %th Orders expiration period
      %td
        = @gateway.orders_expiration_period
        seconds

    %tr
      %th API Gateway ID
      %td= @gateway.straight_gateway_hashed_id

    %tr
      %th Exchange rate providers
      %td= @gateway.exchange_rate_adapter_names.join(", ") if @gateway.exchange_rate_adapter_names.present?

    %tr
      %th Is active?
      %td= @gateway.active ? "Yes" : "No"
      
    %tr
      %th In test mode?
      %td= @gateway.test_mode ? "Yes" : "No"

    %tr
      %th Orders stat
      %td
        new: #{@gateway.order_counters[:new]},
        paid: #{@gateway.order_counters[:paid]},
        overpaid: #{@gateway.order_counters[:overpaid]},
        underpaid: #{@gateway.order_counters[:underpaid]},
        expired: #{@gateway.order_counters[:expired]}
        %span.seeAllOrders ( #{link_to "See all orders for this gateway", orders_path(gateway_id: @gateway.id)} )
