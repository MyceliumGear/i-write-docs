:plain
  require 'straight-server-kit'

  def complete_purchase

    # Save purchase in own DB
    purchase  = Purchase.create(â€¦)

    # Perform signed request to Mycelium Gear API
    client    = StraightServerKit::Client.new(gateway_id: api_gateway_id, secret: gateway_secret)
    new_order = StraightServerKit::Order.new(amount: purchase.amount, callback_data: purchase.id)
    order     = client.orders.create(new_order)

    # Save order reference
    purchase.update(order_id: order.id)

    # Redirect customer to the payment page
    redirect_to client.pay_url(order)
  end
